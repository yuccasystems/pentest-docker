FROM debian:wheezy

LABEL maintainer "dyakimov@swordfishseucrity.com"

# Packages
COPY apt/sources.wheezy      /etc/apt/sources.list
COPY apt/preferences.wheezy  /etc/apt/preferences.d/preferences
COPY apt/conf.archive.wheezy /etc/apt/apt.conf.d/archive

RUN apt-get update && \
    apt-get upgrade -y --force-yes && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --force-yes\
    apache2 \
    wget \
    python \
    python-pip \
    sudo \
    curl 
  #  apt-get clean && \
  #  rm -rf /var/lib/apt/lists/*

COPY packages /packages
COPY index.html /var/www
COPY bash-shellshock.jpg /var/www

RUN dpkg -i /packages/*

COPY vulnerable /usr/lib/cgi-bin/

RUN chown www-data:www-data /var/www/index.html

RUN echo 'www-data ALL=(ALL) NOPASSWD: /usr/bin/python *' >> /etc/sudoers

RUN echo 'ShellSh0kMe!' > /var/www/www-data-secret.txt

RUN echo "RootMyContain3r!" > /root/root-container-secret.txt

RUN chown -R www-data:www-data /var/www/

EXPOSE 80

COPY main.sh /

ENTRYPOINT ["/main.sh"]
CMD ["default"]
